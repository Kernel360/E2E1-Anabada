<div class="pagetitle">
  <nav>
    <ol class="breadcrumb">
      <li class="breadcrumb-item"><a href="/">AnabadA</a></li>
      <li class="breadcrumb-item active">카테고리</li>
    </ol>
  </nav>
</div><!-- End Page Title -->

<section class="section">
  <div class="row">
    <div class="col-lg-12">

      <div class="card">
        <div class="card-body">
          <!-- Table with stripped rows -->
          <table class="table align-middle">
            <thead>
            <tr>
              <th scope="col">No</th>
              <th scope="col">카테고리</th>
            </tr>
            </thead>
            <tbody id="categoryList">
            </tbody>
          </table>

          <div class="row mb-3">
            <div class="col-sm-10">
              <label for="categoryName" class="col-sm-2 col-form-label">카테고리</label>
              <div class="col-sm-10 d-flex">
                <input style="margin-right: 5px;" placeholder="추가할 카테고리를 입력하세요." type="text" class="form-control" id="categoryName" name="categoryName" required>
                <button style="white-space: nowrap" id="categoryCreateButton" class="btn btn-primary"> 카테고리 등록 </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
<script src="/js/commons.js"></script>
<script>
  $(document).ready(function () {
    fn_init();
  });

  function fn_init() {
    fn_getCategoryList(); // 카테고리 목록 조회
    fn_setEvent();
  }

  function fn_setEvent() {
    $('#categoryCreateButton').click(function () {
      var param = {
        "name": $('#categoryName').val(),
      }

      $.ajax({
        url: '/api/v1/categories',
        method: 'POST',
        data: JSON.stringify(param),
        contentType: 'application/json',
        headers: {
          'Authorization': 'Bearer ' + localStorage.getItem("accessToken") // 헤더에 토큰 추가
        },
        success: function (data) {
          authorize('/category/categoryList.html');
        },
        error: function () {
          console.log('fail : category 생성');
        }
      });
    });
  }

  function fn_getCategoryList() {
    // JSON 데이터를 가져오는 비동기 요청
    $.ajax({
      url: '/api/v1/categories',
      method: 'GET',
      dataType: 'json',
      headers: {
        'Authorization': 'Bearer ' + localStorage.getItem("accessToken") // 헤더에 토큰 추가
      },
      success: function (data) {
        var categories = data.categories;

        for (var i = 0; i < categories.length; i++) {
          var category = categories[i];
          var categoryItem = '<tr class="category-item table-list" data-category-id="' + category.id + '">' +
                  '<td>' + category.id + '</td>' +
                  '<td>' + category.name + '</td>' +
                  '<td>'

          if (category.deletedStatus === "FALSE") {
            categoryItem += '<button style="float:right; width: 70px;" id="categoryDeleteButton' + category.id + '" class="btn btn-danger btn-sm" onclick="fn_deleteCategory(' + category.id + ')"> 비활성화</button></td>';
          } else {
            categoryItem += '<button style="float:right; width: 70px;" id="categoryDeleteButton' + category.id + '" class="btn btn-success btn-sm" onclick="fn_deleteCategory(' + category.id + ')"> 활성화</button></td>';
          }

          categoryItem += '</tr>';

          $('#categoryList').append(categoryItem);
        }
      },
      error: function () {
        console.log('fail : 카테고리 목록 조회');
      }
    });
  }

  function fn_updateCategory(categoryId, categoryName) {
    var param = {
      "name": categoryName
    }

    $.ajax({
      url: '/api/v1/categories/' + categoryId,
      method: 'PUT',
      data: JSON.stringify(param),
      contentType: 'application/json',
      headers: {
        'Authorization': 'Bearer ' + localStorage.getItem("accessToken") // 헤더에 토큰 추가
      },
      success: function (data) {
        authorize('/category/categoryList.html');
      },
      error: function () {
        console.log('fail : category 수정 실패');
      }
    });
  }

  function fn_deleteCategory(categoryId) {
    $.ajax({
      url: '/api/v1/categories/' + categoryId,
      method: 'DELETE',
      headers: {
        'Authorization': 'Bearer ' + localStorage.getItem("accessToken") // 헤더에 토큰 추가
      },
      success: function (data) {
        authorize('/category/categoryList.html');
      },
      error: function () {
        console.log('fail : category 삭제 실패');
      }
    });
  }
</script>

